---
title: "Thesis2022_Q2"
author: "Amanda Hastings"
date: "2022-09-19"
output: html_document
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Q2: How does post-fire vegetation cover vary between low and high severity within and across each forest type? 

```{r}
#Read in data 
ThesisDataRaw <- read.csv("HastingsA_MasterThesisData8.8.22.csv")
TerraData <- read.csv("HastingsA_TerraclimateMaster8.16.csv")
ThesisSeedlingsData <- read.csv("HastingsA_MasterSeedlingsData9.12.22.csv")

#Load libraries
library(tidyverse)
library(dplyr)
library(RColorBrewer)
library(emmeans)
library(multcomp)
library(multcompView)
library(ggthemes)
library(scales)
library(car)
```

## Formatting raw thesis site data and seedlings data 

```{r}
#Filter to only wanted sites in ThesisData 
ThesisData <- ThesisDataRaw %>% 
  filter(!PlotID %in% c('LS11','HS02','HS12','HS13', 'LS01_MV','LS02_MV','HS01_MV'))

ThesisSeedlings <- ThesisSeedlingsData %>% 
  filter(!PlotID %in% c('LS11','HS02','HS12','HS13'))%>% 
  dplyr::select(!c(Fire_name, regen_radius, regenplot_size_m2, regenplot_size_ha))%>% 
  select_if(~!any(is.na(.)))

```

## Combining site data with seedlings data

```{r}
ThesisAll1 <- full_join(ThesisData, ThesisSeedlings, by= "PlotID") %>% 
  arrange(PlotID)%>% 
  mutate(forest_type = factor(forest_type))
```

# Plant cover long data

```{r}
# Facet wrap plant cover data
PlantCoverLong <- ThesisAll1 %>%
  dplyr::select(PlotID, forest_type, burn_sev_category, gm_cover:tr_cover) %>%
  tidyr::pivot_longer(gm_cover:tr_cover,
    names_to = "FunctionalGroup",
    values_to = "PercentPlantCover"
  ) %>%
  mutate(FunctionalGroup = factor(
    FunctionalGroup)) %>%
  mutate(forest_type = factor(
    forest_type,
    levels = c("Lower Montane", "Upper Montane","Subalpine")))
```

# Plant cover plot

```{r}
# Facet wrap by forest type - plant cover plot
PlantCoverPlot <- ggplot(
  PlantCoverLong,
  aes(x = FunctionalGroup,
      y = PercentPlantCover,
      fill = burn_sev_category)
) +
  geom_boxplot() + 
  # ylim(0, 0.6) +
  facet_wrap(~ forest_type) +
  theme_classic() +
  labs(x = "Functional Group",
       y = "Percent Cover",
       fill = "Burn Severity") +
  theme(legend.position = "bottom",
        legend.key.width = unit(1, "cm")) +
  theme_few()+
  scale_fill_manual(
    name = "Burn Severity",
    labels = c("Low", "High"), values=c("#fd8d3c","#bd0026"))+
  theme(axis.text.x = element_text(
    color = "black",
    size = 9,
    angle = 30,
    vjust = .8,
    hjust = .8
  ),
  axis.title.x = element_text(size = 11),
  axis.title.y = element_text(size = 11),
  axis.text.y = element_text(size = 8),
  legend.title = element_text(size = 9), 
  legend.text = element_text(size =9)) + 
  scale_x_discrete(labels = c("Forbs", "Graminoids", "Shrubs", "Seedlings"))+
  scale_y_continuous(labels = percent)
PlantCoverPlot 

```

#-----------------------Two-way ANOVA cover analyses----------------------------

# Graminoid ANOVA

```{r,echo=FALSE}
# # Graminoid ANOVA
# hist(ThesisAll1$gm_cover)
# LMFitGM <-
#   lm(gm_cover ~ burn_sev_category * factor(forest_type), data = ThesisAll1)
# anova(LMFitGM)
# par(mfrow = c(1, 2))
# plot(LMFitGM, which = 1:2)

# Sqrt Graminoid ANOVA - Analysis used for presentation(s) 
ThesisAll1$sqrtGM <- sqrt(ThesisAll1$gm_cover)
hist(ThesisAll1$sqrtGM)
LMFitsqrtGM <- lm(sqrt(gm_cover) ~ burn_sev_category * factor(forest_type), data = ThesisAll1)
anova(LMFitsqrtGM)
par(mfrow = c(1, 2))
plot(LMFitsqrtGM, which = 1:2)

# # log Graminoid ANOVA - not used
# ThesisData$logGM <- log(ThesisData$gm_cover + 1)
# hist(ThesisData$logGM)
# LMFitLogGM <-
#   lm(logGM ~ burn_sev_category * factor(forest_type), data = ThesisData)
# anova(LMFitLogGM)
# par(mfrow = c(1, 2))
# plot(LMFitLogGM, which = 1:2)
```

# Pairwise comparison graminoid ANOVA

```{r}
#Tukey pairs Sqrt Graminoids
#Differences by burn severity, but not forest type 
emoutGM <- emmeans(LMFitsqrtGM, ~ burn_sev_category)
emoutGM
pairs(emoutGM)
cld(emoutGM)
```

# Back transform graminoids 

```{r}
backGM <- emmeans(LMFitsqrtGM, pairwise ~ burn_sev_category, regrid = "response")
backGM

```

# Confirmatory plots - graminoid cover by burn severity only

```{r}
GramOnly <- ThesisAll1 %>% 
  dplyr::select(burn_sev_category, gm_cover)

GramBurnSevPlot <- ggplot(data=GramOnly, mapping = aes(x=burn_sev_category, y=gm_cover))+ 
  geom_boxplot()
GramBurnSevPlot
```

# Forb ANOVA 

```{r, echo=FALSE}
# Forb ANOVA - Analysis used for presentation(s)
hist(ThesisAll1$fb_cover)
LMFitFB <-
  lm(fb_cover ~ burn_sev_category * forest_type, data = ThesisAll1)
anova(LMFitFB)
par(mfrow = c(1, 2))
plot(LMFitFB, which = 1:2)

# Sqrt Forb ANOVA 
# ThesisAll1$sqrtFB <- sqrt(ThesisData$fb_cover)
# hist(ThesisAll1$sqrtFB)
# LMFitsqrtFB <- lm(sqrtFB ~ burn_sev_category * factor(forest_type), data = ThesisAll1)
# anova(LMFitsqrtFB)
# par(mfrow = c(1, 2))
# plot(LMFitsqrtFB, which = 1:2)

# # log Forb ANOVA - not used
# ThesisData$logFB <- log(ThesisData$fb_cover + 1)
# hist(ThesisData$logFB)
```

# Pairwise comparison forb ANOVA

```{r}
#Tukey pairs Forbs 
#Differences by forest type, but not burn severity 
emoutFB <- emmeans(LMFitFB, ~ factor(forest_type))
emoutFB
pairs(emoutFB)
cld(emoutFB)
```

# Confirmatory plots - forb cover by forest type only 

```{r}
ForbOnly <- ThesisAll1 %>% 
  dplyr::select(forest_type, fb_cover)

ForbForestTypePlot <- ggplot(data=ForbOnly, mapping = aes(x=forest_type, y=fb_cover))+ 
  geom_boxplot()
ForbForestTypePlot 
```


#-----------------------Logistic regression cover analyses----------------------


# Plant Cover Long Data plus Binary Column
```{r}
# Round percent cover to four decimal places 
PlantCoverLong$PercentPlantCover <- round(PlantCoverLong$PercentPlantCover,4)


PlantCoverBinary <- PlantCoverLong %>% 
  mutate("BinaryCover" = case_when(PercentPlantCover == 0.0000 ~ 0,
         PercentPlantCover != 0.0000 ~ 1))
```


# Shrub Cover Logistic Regression 
```{r}
PlantCoverBinary$BinaryCover <- as.factor(PlantCoverBinary$BinaryCover)

ShrubCoverBinary <- PlantCoverBinary %>% 
  filter(FunctionalGroup == 'sh_cover')

LogisFitSH <- glm(BinaryCover ~ burn_sev_category* forest_type, data=ShrubCoverBinary, family= "binomial" )

summary(LogisFitSH)
Anova(LogisFitSH,type=3)
```
#########Need to look at this 

```{r}
emmeans(LogisFitSH,pairwise~burn_sev_category*forest_type,type="response")
```


# Tree Cover Logistic Regression 
```{r}
TreeCoverBinary <- PlantCoverBinary %>% 
  filter(FunctionalGroup == 'tr_cover')

LogisFitTR <- glm(BinaryCover ~ burn_sev_category * forest_type, data=TreeCoverBinary, family= "binomial" )

summary(LogisFitTR)
Anova(LogisFitTR, type=3)
```


#########Need to look at this 

```{r}
emoutTR <- emmeans(LogisFitTR, ~ factor(forest_type))
emoutTR
pairs(emoutTR)
cld(emoutTR)
```











