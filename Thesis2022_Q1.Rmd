---
title: "Thesis2022_Q1"
author: "Amanda Hastings"
date: "2022-09-19"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Q1: How are different tree species regenerating across forest types at low and high burn severities?

```{r}
#Read in data 
ThesisDataRaw <- read.csv("HastingsA_MasterThesisData8.8.22.csv")
TerraData <- read.csv("HastingsA_TerraclimateMaster8.16.csv")
ThesisSeedlingsData <- read.csv("HastingsA_MasterSeedlingsData9.12.22.csv")

#Load libraries
library(tidyverse)
library(dplyr)
library(RColorBrewer)
library(emmeans)
library(multcomp)
library(multcompView)
library(ggthemes)
```

## Formatting raw thesis site data and seedlings data 

```{r}
#Filter to only wanted sites in ThesisData 
ThesisData <- ThesisDataRaw %>% 
  filter(!PlotID %in% c('LS11','HS02','HS12','HS13', 'LS01_MV','LS02_MV','HS01_MV'))

ThesisSeedlings <- ThesisSeedlingsData %>% 
  filter(!PlotID %in% c('LS11','HS02','HS12','HS13'))%>% 
  dplyr::select(!c(Fire_name, regen_radius, regenplot_size_m2, regenplot_size_ha))%>% 
  select_if(~!any(is.na(.)))

```

## Combining site data with seedlings data

```{r}
ThesisAll1 <- full_join(ThesisData, ThesisSeedlings, by= "PlotID") %>% 
  arrange(PlotID)%>% 
  mutate(forest_type = factor(forest_type))

```

## Create data frame with na values for tree species not expected in forest types 

```{r}
ThesisSeedRename <- ThesisAll1 %>% 
  dplyr::select(forest_type, burn_sev_category, POTR_total, QUGA_total, RONE_total, PIPO_total, PSME_total, ABCO_total, PICO_total, PIFL_total, PIAR_total, ABLA_total, PIEN_total)%>%
  rename("POTR"= 3, "QUGA"= 4, "RONE"= 5, "PIPO"= 6, "PSME"= 7, "ABCO"= 8,  "PICO" = 9, "PIFL" = 10, "PIAR"=11, "ABLA"=12, "PIEN"=13)


ThesisNAs <- ThesisSeedRename %>%
  mutate(QUGA = replace(QUGA, forest_type == "Subalpine", NA))%>% 
  mutate(RONE = replace(RONE, forest_type == "Subalpine" | forest_type == "Upper Montane", NA))%>% 
  mutate(PIPO = replace(PIPO, forest_type == "Subalpine" | forest_type == "Upper Montane", NA))%>% 
  mutate(PIFL = replace(PIFL, forest_type == "Lower Montane", NA))%>% 
  mutate(PIAR = replace(PIAR, forest_type == "Lower Montane" | forest_type == "Upper Montane", NA))%>% 
  mutate(ABLA = replace(ABLA, forest_type == "Lower Montane" | forest_type == "Upper Montane", NA))%>% 
  mutate(PIEN = replace(PIEN, forest_type == "Lower Montane" | forest_type == "Upper Montane", NA))
  
         
```


# Seedlings long data
```{r}
# Covert seedlings data to long format
SeedlingsLong <- ThesisNAs %>%
  tidyr::pivot_longer(cols = c(POTR:PIEN),
                      names_to = "Species",
                      values_to = "Density") %>% 
  mutate(forest_type = factor(
    forest_type,
    levels = c("Lower Montane", "Upper Montane", "Subalpine")
  )) %>% 
  mutate(Species = factor(Species,
                          levels = c("PIPO","PSME","ABCO","PICO","PIFL", "PIAR","ABLA","PIEN", "QUGA", "RONE","POTR")))
```


# Facet axis removing labels for species not present in forest types 

```{r}
#Omit na values
SeedlingsLong2 <- SeedlingsLong %>% 
  na.omit
```


# Seedlings plot 
```{r}
# Facet wrap by forest type - seedlings plot

ggplot(SeedlingsLong2,
       aes(x = Species, y = Density, fill = burn_sev_category)) +
  geom_boxplot() + 
  # ylim(0, 25000) +
  facet_wrap(~ forest_type, scales="free_x") +
  labs(x = "Species",
       y = "Seedlings per hectare",
       fill = "Burn Severity") +
  theme(legend.position = "bottom",
        legend.key.width = unit(1, "cm")) +
  theme_few() +
  scale_fill_manual(
    name = "Burn Severity",
    labels = c("Low", "High"), values=c("#fd8d3c","#bd0026")) +
  theme(
    axis.text.x = element_text(
      color = "black",
      size = 6,
      angle = 45,
      vjust = .8,
      hjust = .8
    ), 
    axis.title.x=element_text(size=11), 
    axis.title.y=element_text(size=11), 
    axis.text.y = element_text(size=8), 
    legend.title=element_text(size=11))
```

# Data frame analyses grouped by conifer/decid 

```{r}
#Add conifer and deciduous total columns 
#POTR_total, QUGA_total, RONE_total, PIPO_total, PSME_total, ABCO_total, PICO_total, PIFL_total, PIAR_total, ABLA_total, PIEN_total

decid_list = c("POTR_total", "QUGA_total", "RONE_total")
conifer_list = c("PIPO_total", "PSME_total", "ABCO_total", "PICO_total", "PIFL_total", "PIAR_total", "ABLA_total", "PIEN_total")


ThesisAll1 <- ThesisAll1 %>% 
  mutate("deciduous_total" = rowSums(ThesisAll1[,decid_list])) %>% 
  mutate("conifer_total" = rowSums(ThesisAll1[,conifer_list]))
```


#------------Conifer/decid analyses---------------------------------------------


# Two way ANOVA deciduous density only, sqrt transform
```{r}
# Two way ANOVA deciduous, sqrt transform
LMFitDecidsqrt <- lm(sqrt(deciduous_total) ~ burn_sev_category * forest_type, data = ThesisAll1)
anova(LMFitDecidsqrt)
par(mfrow = c(1, 2))
plot(LMFitDecidsqrt, which = 1:2)
```



